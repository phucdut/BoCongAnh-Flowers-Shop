<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&amp;display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="catalog/view/stylesheet/fonts/fontawesome/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" th:href="@{/css/product_Detail.css}">
    <title>Trang chủ</title>
</head>
<body>
<th:block th:replace="header.html"></th:block>
<main>
    <div class="container_main">
        <div class="product_Detail">
            <div class="column_left">
                <input type="hidden" th:value="${product.id}" id="id">
                <img th:src="@{'/images/product/' + ${product.image1}}" alt="java">
            </div>
            <div class="column_right">
                <h3 th:text="${product.name}"></h3>
                <h4 th:text="${product.price}"></h4>

                <p id="amount">Khuyến mãi: </p>
                <p><span>Gọi ngay:</span><span class="phone"> 42678899</span></p>
                <div class="social">
                    <p><span>Chat ngay:</span> </p>
                    <ul>
                        <li>
                            <a>
                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 48 48">
                                    <path fill="#039be5" d="M24 5A19 19 0 1 0 24 43A19 19 0 1 0 24 5Z"></path><path fill="#fff" d="M26.572,29.036h4.917l0.772-4.995h-5.69v-2.73c0-2.075,0.678-3.915,2.619-3.915h3.119v-4.359c-0.548-0.074-1.707-0.236-3.897-0.236c-4.573,0-7.254,2.415-7.254,7.917v3.323h-4.701v4.995h4.701v13.729C22.089,42.905,23.032,43,24,43c0.875,0,1.729-0.08,2.572-0.194V29.036z"></path>
                                </svg>
                            </a>
                        </li>
                        <li>
                            <a>
                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 48 48">
                                    <linearGradient id="_osn9zIN2f6RhTsY8WhY4a_5MQ0gPAYYx7a_gr1" x1="10.341" x2="40.798" y1="8.312" y2="38.769" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#2aa4f4"></stop><stop offset="1" stop-color="#007ad9"></stop></linearGradient><path fill="url(#_osn9zIN2f6RhTsY8WhY4a_5MQ0gPAYYx7a_gr1)" d="M46.105,11.02c-1.551,0.687-3.219,1.145-4.979,1.362c1.789-1.062,3.166-2.756,3.812-4.758	c-1.674,0.981-3.529,1.702-5.502,2.082C37.86,8.036,35.612,7,33.122,7c-4.783,0-8.661,3.843-8.661,8.582	c0,0.671,0.079,1.324,0.226,1.958c-7.196-0.361-13.579-3.782-17.849-8.974c-0.75,1.269-1.172,2.754-1.172,4.322	c0,2.979,1.525,5.602,3.851,7.147c-1.42-0.043-2.756-0.438-3.926-1.072c0,0.026,0,0.064,0,0.101c0,4.163,2.986,7.63,6.944,8.419	c-0.723,0.198-1.488,0.308-2.276,0.308c-0.559,0-1.104-0.063-1.632-0.158c1.102,3.402,4.299,5.889,8.087,5.963	c-2.964,2.298-6.697,3.674-10.756,3.674c-0.701,0-1.387-0.04-2.065-0.122C7.73,39.577,12.283,41,17.171,41	c15.927,0,24.641-13.079,24.641-24.426c0-0.372-0.012-0.742-0.029-1.108C43.483,14.265,44.948,12.751,46.105,11.02"></path>
                                </svg>
                            </a>
                        </li>
                        <li>
                            <a>
                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 48 48">
                                    <radialGradient id="yOrnnhliCrdS2gy~4tD8ma_Xy10Jcu1L2Su_gr1" cx="19.38" cy="42.035" r="44.899" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fd5"></stop><stop offset=".328" stop-color="#ff543f"></stop><stop offset=".348" stop-color="#fc5245"></stop><stop offset=".504" stop-color="#e64771"></stop><stop offset=".643" stop-color="#d53e91"></stop><stop offset=".761" stop-color="#cc39a4"></stop><stop offset=".841" stop-color="#c837ab"></stop></radialGradient><path fill="url(#yOrnnhliCrdS2gy~4tD8ma_Xy10Jcu1L2Su_gr1)" d="M34.017,41.99l-20,0.019c-4.4,0.004-8.003-3.592-8.008-7.992l-0.019-20	c-0.004-4.4,3.592-8.003,7.992-8.008l20-0.019c4.4-0.004,8.003,3.592,8.008,7.992l0.019,20	C42.014,38.383,38.417,41.986,34.017,41.99z"></path><radialGradient id="yOrnnhliCrdS2gy~4tD8mb_Xy10Jcu1L2Su_gr2" cx="11.786" cy="5.54" r="29.813" gradientTransform="matrix(1 0 0 .6663 0 1.849)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#4168c9"></stop><stop offset=".999" stop-color="#4168c9" stop-opacity="0"></stop></radialGradient><path fill="url(#yOrnnhliCrdS2gy~4tD8mb_Xy10Jcu1L2Su_gr2)" d="M34.017,41.99l-20,0.019c-4.4,0.004-8.003-3.592-8.008-7.992l-0.019-20	c-0.004-4.4,3.592-8.003,7.992-8.008l20-0.019c4.4-0.004,8.003,3.592,8.008,7.992l0.019,20	C42.014,38.383,38.417,41.986,34.017,41.99z"></path><path fill="#fff" d="M24,31c-3.859,0-7-3.14-7-7s3.141-7,7-7s7,3.14,7,7S27.859,31,24,31z M24,19c-2.757,0-5,2.243-5,5	s2.243,5,5,5s5-2.243,5-5S26.757,19,24,19z"></path><circle cx="31.5" cy="16.5" r="1.5" fill="#fff"></circle><path fill="#fff" d="M30,37H18c-3.859,0-7-3.14-7-7V18c0-3.86,3.141-7,7-7h12c3.859,0,7,3.14,7,7v12	C37,33.86,33.859,37,30,37z M18,13c-2.757,0-5,2.243-5,5v12c0,2.757,2.243,5,5,5h12c2.757,0,5-2.243,5-5V18c0-2.757-2.243-5-5-5H18z"></path>
                                </svg>
                            </a>
                        </li>

                    </ul>


                </div>

                <p>Vận chuyển: Miễn phí giao hoa khu vực nội thành TP.HCM & Hà Nội</p>

                <div class="group-button">
<!--                    <button class="prev" id="prev">-</button>-->
<!--                    <span class="quality" id="quality">1</span>-->
<!--                    <button class="next" id="next">+</button>-->
                    <button class="cartButton" id="cartButton" type="submit" onclick="submitForm()">Giỏ Hàng</button>
                </div>
            </div>
        </div>


        <div class="desc">
            <h4>Mô tả sản phẩm</h4>
            <h5>Bó hoa được thiết kế từ</h5>
            <ul>
                <li>Hoa hướng dương: 1 cành</li>
                <li>Hoa baby trắng: 50gram</li>
                <li>Hoa hoàng anh: 3 </li>
                <li>Các loại hoa lá phụ trang trí khác</li>
            </ul>
            <p>Lưu ý:</p>
            <p>**Sản phẩm thực nhận có thể khác với hình đại diện trên website (đặc điểm thủ công và tính chất tự nhiên của hàng nông nghiệp)</p>
        </div>

        <div class="relatedProduct">
            <h3>Sản phẩm liên quan</h3>
        </div>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // const prevButton = document.getElementById('prev');
        // const nextButton = document.getElementById('next');
        // const qualitySpan = document.getElementById('quality');
        //
        // prevButton.addEventListener('click', function () {
        //     let quality = parseInt(qualitySpan.textContent, 10);
        //     if (quality > 1) {
        //         quality -= 1;
        //         qualitySpan.textContent = quality;
        //     }
        // });
        //
        // nextButton.addEventListener('click', function () {
        //     let quality = parseInt(qualitySpan.textContent, 10);
        //     quality += 1;
        //     qualitySpan.textContent = quality;
        // });

        const cartButton = document.getElementById('cartButton');
        cartButton.addEventListener('click', function () {
            const productId = document.getElementById('id').value; // Get the product ID
            // let quality = parseInt(qualitySpan.textContent, 10); // Get the current quantity
            submitForm(productId);
        });

        function submitForm(productId) {
            const apiUrl = '/api/cart/add/' + productId ; // Include quantity in the API call

            fetch(apiUrl, {
                method: 'GET', // Consider using 'POST' or 'PUT' if appropriate
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // console.log('Item added to the cart successfully with quantity:', quantity);
                    } else {
                        console.log('Failed to add item to the cart');
                    }
                    viewCart(); // Update cart view
                })
                .catch(error => {
                    console.error('Error:', error);
                    console.log('An error occurred while adding the item to the cart');
                });
        }
    function viewCart() {
            const apiUrl = '/api/cart';

            return fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Failed to fetch cart data');
                })
                .then(cartItems => {
                    console.log('Cart items:', cartItems);
                    const totalQuantity = cartItems.reduce((total, item) => total + item.quantity, 0);

                    document.getElementById('cartItemCount').innerText = totalQuantity.toString();
                    console.log('Tổng số lượng sản phẩm trong giỏ hàng: ' + totalQuantity);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    });

</script>
</body>
</html>